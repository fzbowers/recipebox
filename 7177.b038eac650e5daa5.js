"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[7177],{7177:(T,v,p)=>{p.r(v),p.d(v,{NewrecipePageModule:()=>C});var b=p(177),u=p(4341),o=p(8974),_=p(1626),f=p(7570),y=p(467),F=p(613),e=p(4438),N=p(3366);function A(r,d){if(1&r&&(e.j41(0,"ion-select-option",20),e.EFF(1),e.k0s()),2&r){const a=d.$implicit;e.Y8G("value",a),e.R7$(),e.JRh(a)}}function I(r,d){if(1&r){const a=e.RV6();e.j41(0,"ion-item",21),e.nrm(1,"ion-input",22)(2,"ion-input",23)(3,"ion-input",24),e.j41(4,"ion-button",25),e.bIt("click",function(){const t=e.eBV(a).index,n=e.XpG();return e.Njj(n.removeIngredient(t))}),e.EFF(5,"-"),e.k0s()()}2&r&&e.Y8G("formGroupName",d.index)}function R(r,d){if(1&r){const a=e.RV6();e.j41(0,"ion-item",21),e.nrm(1,"ion-input",26),e.j41(2,"ion-button",25),e.bIt("click",function(){const t=e.eBV(a).index,n=e.XpG();return e.Njj(n.removeDirection(t))}),e.EFF(3,"-"),e.k0s()()}2&r&&e.Y8G("formGroupName",d.index)}function w(r,d){if(1&r&&(e.j41(0,"ion-select-option",20),e.EFF(1),e.k0s()),2&r){const a=d.$implicit;e.Y8G("value",a.id),e.R7$(),e.JRh(a.title)}}const P=[{path:"",component:(()=>{var r;class d{constructor(i,t,n,s,m){this._router=i,this.route=t,this.formBuilder=n,this.apiService=s,this.alertController=m,this.edit=!1,this.sections_exist=!1,this.disableButton=!1,this.sections=[],this.recipe=null,this.timeUnits=Object.values(F.y),this.searchQuery="",this.recipeForm=this.formBuilder.group({title:["",[u.k0.required]],time:["",[u.k0.required]],time_unit:["",[u.k0.required]],ingredients:this.formBuilder.array([]),directions:this.formBuilder.array([]),section_ids:[[]]})}ngOnInit(){this._router.events.subscribe(i=>{i instanceof f.wF&&"/newrecipe"===i.url&&(this.disableButton=!1,this.recipeForm.reset(),(0!==this.ingredientsArray.length||0!==this.directionsArray.length)&&this.clearIngredientsDirections(),this.addIngredient(),this.addDirection())}),this.loadSections(),this.route.params.subscribe(i=>{const t=i.id;t&&(this.edit=!0,0===this.ingredientsArray.length&&0===this.directionsArray.length&&this.loadRecipe(t))})}ionChange(i){console.log("search event: ",i.detail.value),this.searchQuery="",this._router.navigate(["/search",i.detail.value])}loadRecipe(i){this.apiService.get_with_id("recipes",i.toString()).subscribe({next:t=>{console.log("Recipe:",t.recipe),this.recipe=t.recipe,this.patchRecipe(t.section_ids)},error:t=>{console.error("Error getting recipe details:",t)},complete:()=>{}})}patchRecipe(i){if(!this.recipe)return;console.log("in patchRecipe"),this.recipeForm.patchValue({title:this.recipe.title,time:this.recipe.time,time_unit:this.recipe.time_unit,section_ids:i});const t=this.recipeForm.get("ingredients");this.recipe.ingredients.forEach(s=>{t.push(this.createIngredientFormGroup(s.name,s.amount,s.amount_unit))});const n=this.recipeForm.get("directions");this.recipe.directions.forEach(s=>{n.push(this.createDirectionFormGroup(s.description))}),0===this.ingredientsArray.length&&this.addIngredient(),0===this.directionsArray.length&&this.addDirection()}presentAlert(i){var t=this;return(0,y.A)(function*(){yield(yield t.alertController.create({header:"Alert",message:i,buttons:["OK"]})).present()})()}saveRecipe(){this.disableButton=!0,console.log("in saveRecipe");let[i,t]=this.removeEmptyIngredientsDirections();var n,s,m,h,l;if((!this.sections_exist||null===this.recipeForm.controls.section_ids.value)&&this.recipeForm.controls.section_ids.setValue([]),console.log("current form:",this.recipeForm.value),this.recipeForm.invalid)return console.log("recipeForm is invalid",this.recipeForm.value),null!==(n=this.recipeForm.get("title"))&&void 0!==n&&n.errors?(console.log("Invalid title"),this.presentAlert("Invalid Title")):null!==(s=this.recipeForm.get("time"))&&void 0!==s&&s.errors?this.presentAlert("Invalid Time"):null!==(m=this.recipeForm.get("time_unit"))&&void 0!==m&&m.errors?this.presentAlert("Invalid Time Unit"):0===i?this.presentAlert("Invalid Ingredients"):0===t&&this.presentAlert("Invalid Directions"),void(this.disableButton=!1);console.log("save recipe recipeForm.value: ",this.recipeForm.value),this.edit?(console.log("in edit statement, recipe.id = ",null===(h=this.recipe)||void 0===h?void 0:h.id.toString()),this.apiService.put_with_id("recipes",(null===(l=this.recipe)||void 0===l?void 0:l.id.toString())||"",this.recipeForm.value).subscribe({next:c=>{var g;console.log("Successful Response:",c),this.goToRecipe((null===(g=this.recipe)||void 0===g?void 0:g.id.toString())||"")},error:c=>{console.error("unsuccessful",c),400===c.status&&"Recipe title already exists"===c.error.error&&this.presentAlert("Recipe title already exists"),this.disableButton=!1},complete:()=>{}})):this.apiService.post("recipes",this.recipeForm.value).subscribe({next:c=>{console.log("Successful Response:",c),this.goToRecipe(c.recipe_id)},error:c=>{console.error("unsuccessful",c),400===c.status&&"Recipe title already exists"===c.error.error&&this.presentAlert("Recipe title already exists"),this.disableButton=!1},complete:()=>{}})}updateSectionIds(i){this.recipeForm.controls.section_ids.setValue(i.detail.value)}loadSections(){console.log("Loading sections..."),this.apiService.get_all("sections").subscribe({next:i=>{console.log("All sections response:",i),this.sections=i.sections,this.sections_exist=this.sections.length>0},error:i=>{console.error("Error getting all sections:",i)},complete:()=>{}})}createIngredientFormGroup(i="",t=null,n=null){return this.formBuilder.group({name:[i,u.k0.required],amount:[t,u.k0.required],amount_unit:[n]})}createDirectionFormGroup(i=""){return this.formBuilder.group({description:[i]})}addIngredient(){const i=this.createIngredientFormGroup();this.ingredientsArray.push(i)}addDirection(){const i=this.createDirectionFormGroup();this.directionsArray.push(i)}removeIngredient(i){this.ingredientsArray.removeAt(i)}get ingredientsArray(){return this.recipeForm.get("ingredients")}removeDirection(i){this.directionsArray.removeAt(i)}get directionsArray(){return this.recipeForm.get("directions")}clearIngredientsDirections(){for(;0!==this.ingredientsArray.length;)this.removeIngredient(0);for(;0!==this.directionsArray.length;)this.removeDirection(0)}removeEmptyIngredientsDirections(){var i=0,t=0;for(let l=0;l<this.ingredientsArray.length;l++){var n,s,m;console.log("ingredient idx:",l);const c=this.ingredientsArray.at(l),g=null===(n=c.get("name"))||void 0===n?void 0:n.value,j=null===(s=c.get("amount"))||void 0===s?void 0:s.value,k=null===(m=c.get("amount_unit"))||void 0===m?void 0:m.value;!g&&!j&&!k&&0!=l&&(this.removeIngredient(l),l-=1),i=l}for(let l=0;l<this.directionsArray.length;l++){var h;console.log("direction idx:",l),!(null===(h=this.directionsArray.at(l).get("description"))||void 0===h?void 0:h.value)&&0!=l&&(this.removeDirection(l),l-=1),t=l}return[i,t]}cancel(){var i;this.disableButton=!1,this.recipeForm.reset(),(0!==this.ingredientsArray.length||0!==this.directionsArray.length)&&this.clearIngredientsDirections(),this.edit?this.goToRecipe((null===(i=this.recipe)||void 0===i?void 0:i.id.toString())||""):this.goHome()}goHome(){this._router.navigate(["/home"])}goToAccount(){this._router.navigate(["/useraccount"])}goToRecipe(i){this._router.navigate(["/recipe",i])}}return(r=d).\u0275fac=function(i){return new(i||r)(e.rXU(f.Ix),e.rXU(f.nX),e.rXU(u.ok),e.rXU(N.G),e.rXU(o.hG))},r.\u0275cmp=e.VBU({type:r,selectors:[["app-newrecipe"]],decls:42,vars:9,consts:[[3,"translucent"],["slot","start"],["enterkeyhint","search","debounce","1000",1,"search",3,"ngModelChange","ionChange","ngModel"],[3,"fullscreen"],["collapse","condense"],["size","large"],["color","primary",1,"header"],[1,"ion-text-center"],[3,"ngSubmit","formGroup"],["labelPlacement","floating","label","Title","formControlName","title","type","text"],["labelPlacement","floating","label","Time","formControlName","time","type","number",2,"margin-right","10px"],["interface","popover","labelPlacement","floating","label","Time Unit","formControlName","time_unit",2,"min-width","150px"],[3,"value",4,"ngFor","ngForOf"],["formArrayName","ingredients"],[3,"formGroupName",4,"ngFor","ngForOf"],[3,"click"],["formArrayName","directions"],["position","floating"],["interface","popover","formControlName","section_ids","multiple","true",3,"ionChange"],["type","submit",3,"disabled"],[3,"value"],[3,"formGroupName"],["labelPlacement","floating","label","Ingredient","formControlName","name","type","text",2,"margin-right","10px"],["labelPlacement","floating","label","Amount","formControlName","amount","type","number",2,"margin-right","10px"],["labelPlacement","floating","label","Unit","formControlName","amount_unit","type","text"],["fill","clear",2,"font-size","25px",3,"click"],["labelPlacement","floating","label","Direction","formControlName","description","type","text"]],template:function(i,t){1&i&&(e.j41(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-buttons",1),e.nrm(3,"ion-menu-button"),e.k0s(),e.j41(4,"ion-searchbar",2),e.mxI("ngModelChange",function(s){return e.DH7(t.searchQuery,s)||(t.searchQuery=s),s}),e.bIt("ionChange",function(s){return t.ionChange(s)}),e.k0s()()(),e.j41(5,"ion-content",3)(6,"ion-header",4)(7,"ion-toolbar")(8,"ion-title",5),e.EFF(9,"New Recipe"),e.k0s()()(),e.j41(10,"ion-card")(11,"ion-card-header",6)(12,"ion-card-title",7),e.EFF(13,"Add New Recipe"),e.k0s()(),e.j41(14,"ion-card-content")(15,"form",8),e.bIt("ngSubmit",function(){return t.saveRecipe()}),e.j41(16,"ion-list")(17,"ion-item"),e.nrm(18,"ion-input",9),e.k0s(),e.j41(19,"ion-item"),e.nrm(20,"ion-input",10),e.j41(21,"ion-select",11),e.DNE(22,A,2,2,"ion-select-option",12),e.k0s()(),e.j41(23,"div",13),e.DNE(24,I,6,1,"ion-item",14),e.j41(25,"ion-button",15),e.bIt("click",function(){return t.addIngredient()}),e.EFF(26,"Add Ingredient"),e.k0s()(),e.j41(27,"div",16),e.DNE(28,R,4,1,"ion-item",14),e.j41(29,"ion-button",15),e.bIt("click",function(){return t.addDirection()}),e.EFF(30,"Add Direction"),e.k0s()(),e.j41(31,"div")(32,"ion-item")(33,"ion-label",17),e.EFF(34,"Sections"),e.k0s(),e.j41(35,"ion-select",18),e.bIt("ionChange",function(s){return t.updateSectionIds(s)}),e.DNE(36,w,2,2,"ion-select-option",12),e.k0s()()()(),e.nrm(37,"br"),e.j41(38,"ion-button",19),e.EFF(39,"Save"),e.k0s(),e.j41(40,"ion-button",15),e.bIt("click",function(){return t.cancel()}),e.EFF(41,"Cancel"),e.k0s()()()()()),2&i&&(e.Y8G("translucent",!0),e.R7$(4),e.R50("ngModel",t.searchQuery),e.R7$(),e.Y8G("fullscreen",!0),e.R7$(10),e.Y8G("formGroup",t.recipeForm),e.R7$(7),e.Y8G("ngForOf",t.timeUnits),e.R7$(2),e.Y8G("ngForOf",t.ingredientsArray.controls),e.R7$(4),e.Y8G("ngForOf",t.directionsArray.controls),e.R7$(8),e.Y8G("ngForOf",t.sections),e.R7$(2),e.Y8G("disabled",t.disableButton))},dependencies:[b.Sq,u.qT,u.BC,u.cb,u.vS,u.j4,u.JD,u.$R,u.v8,o.Jm,o.QW,o.b_,o.I9,o.ME,o.tN,o.W9,o.eU,o.$w,o.uz,o.he,o.nf,o.MC,o.S1,o.Nm,o.Ip,o.BC,o.ai,o.su,o.Je,o.Gw],styles:[".header[_ngcontent-%COMP%]{font-family:Yeseva One,serif;font-weight:400;font-style:normal}"]}),d})()}];let G=(()=>{var r;class d{}return(r=d).\u0275fac=function(i){return new(i||r)},r.\u0275mod=e.$C({type:r}),r.\u0275inj=e.G2t({imports:[f.iI.forChild(P),f.iI]}),d})(),C=(()=>{var r;class d{}return(r=d).\u0275fac=function(i){return new(i||r)},r.\u0275mod=e.$C({type:r}),r.\u0275inj=e.G2t({imports:[b.MD,u.YN,u.X1,o.bv,G,_.q1]}),d})()}}]);